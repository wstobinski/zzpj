<app-top-toolbar title="Twoje konto"></app-top-toolbar>
@if (isLoading) {
  <ion-progress-bar type="indeterminate"></ion-progress-bar>
}
<ion-content>
  <div style="width: 50%; margin: auto">
    <ion-text color="secondary">
      <h3>Dane konta</h3>
      <h4>Adres email:
        <ion-text color="primary">
          {{user?.email}}
        </ion-text>
      </h4>
      <h5>Rola systemowa:
        <ion-text color="primary">
           {{user?.role | roleTranslate}}
        </ion-text>
      </h5>

    </ion-text>
    <h5 style="margin-top: 50px;">Zmień hasło</h5>
    <form [formGroup]="accountFormGroup" (keyup)="markUnsavedChanges()" (ngSubmit)="onPasswordChanged()">
      <ion-list>
        <ion-item>
          <ion-label position="floating">Hasło (stare)</ion-label>
          <ion-input [type]="oldPwdType" formControlName="oldPassword"></ion-input>
          <ion-icon style="margin-top: 20px" [name]="showOldPwdIcon" slot="end" (click)="onChangePwdType('old')"></ion-icon>
        </ion-item>
        @if (formControlHasError('oldPassword', 'required')) {
          <ion-item lines="none">
            <ion-label class="error-label">
              Hasło (stare) jest wymagane
            </ion-label>

          </ion-item>
        } @else if (formControlHasError('oldPassword', 'minlength')) {
          <ion-item lines="none">
            <ion-label class="error-label">
              Hasło musi mieć minimum 8 znaków
            </ion-label>
          </ion-item>
        }
        <ion-item>
          <ion-label position="floating">Hasło (nowe)</ion-label>
          <ion-input [type]="pwdType" formControlName="newPassword"></ion-input>
          <ion-icon style="margin-top: 20px" [name]="showPwdIcon" slot="end" (click)="onChangePwdType('new')"></ion-icon>
        </ion-item>
        @if (formControlHasError('newPassword', 'required')) {
          <ion-item lines="none">
            <ion-label class="error-label">
              Nowe hasło jest wymagane
            </ion-label>

          </ion-item>
        } @else if (formControlHasError('newPassword', 'minlength')) {
          <ion-item lines="none">
            <ion-label class="error-label">
              Hasło musi mieć minimum 8 znaków
            </ion-label>
          </ion-item>
        }
        <ion-item>
          <ion-label position="floating">Powtórz nowe hasło</ion-label>
          <ion-input [type]="pwdType" formControlName="passwordConfirm"></ion-input>
          <ion-icon style="margin-top: 20px" [name]="showPwdIcon" slot="end" (click)="onChangePwdType('new')"></ion-icon>
        </ion-item>
        @if (formHasError('passwordMismatch') && accountFormGroup.get('passwordConfirm').touched) {
          <ion-item lines="none">
            <ion-label class="error-label">
              Hasła nie pasują do siebie
            </ion-label>
          </ion-item>
        }
      </ion-list>

      <ion-row class="ion-padding">
        <ion-button type="submit" color="primary" expand="block" [disabled]="!accountFormGroup.valid || isLoading">
          <ion-icon slot="start" name="checkmark-circle-outline"></ion-icon>
          Zapisz zmiany
        </ion-button>
      </ion-row>
    </form>
  </div>
</ion-content>
