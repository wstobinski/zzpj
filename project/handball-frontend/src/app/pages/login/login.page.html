<app-top-toolbar title="Login"></app-top-toolbar>

<ion-content>
  <ion-row>
    <ion-col>
      <ion-item class="ion-align-self-center" lines="none">
        <ion-text color="secondary">
          <h3>Login or activate your account</h3>
        </ion-text>
      </ion-item>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
      <ion-card class="ion-text-center" color="secondary" style="width: 50%; margin: 0 auto;">
        <ion-card-header>
          <ion-card-title>{{getCardTitle()}}</ion-card-title>
          <ion-card-subtitle>
            <ion-text style="cursor: pointer;" (click)="toggleFormType()">{{getCardSubtitle()}}
            </ion-text>
          </ion-card-subtitle>
        </ion-card-header>

        <ion-card-content>
          @if (loginFormPresented) {
            <form [formGroup]="loginForm" (ngSubmit)="onLogin()">
              <ion-item>
                <ion-label position="stacked">Your email</ion-label>
                <ion-input placeholder="Enter your email here..." type="email" formControlName="email"></ion-input>
              </ion-item>
              @if (formControlHasError(loginForm, 'email', 'required')) {
                <ion-item lines="none">
                  <ion-label class="error-label">
                    Email is required
                  </ion-label>
                </ion-item>
              }
              @if (formControlHasError(loginForm, 'email', 'email')) {
                <ion-item lines="none">
                  <ion-label class="error-label">
                    Enter a valid email address
                  </ion-label>
                </ion-item>
              }
              <ion-item>
                <ion-label position="stacked">Your password</ion-label>
                <ion-input placeholder="Enter your password here..." type="password" formControlName="password"></ion-input>
              </ion-item>
              @if (formControlHasError(loginForm, 'password', 'required')) {
                <ion-item lines="none">
                  <ion-label class="error-label">
                    Password is required
                  </ion-label>
                </ion-item>
              }
              @if (formControlHasError(loginForm, 'password', 'minlength')) {
                <ion-item lines="none">
                  <ion-label class="error-label">
                    Password needs to be at least 8 characters long
                  </ion-label>
                </ion-item>
              }
              <ion-button [disabled]="!loginForm.valid" type="submit">Login</ion-button>
            </form>
          }
          @if (!loginFormPresented) {
            <form [formGroup]="activationForm" (ngSubmit)="onActivate()">
              <ion-item>
                <ion-label position="stacked">Your activation code</ion-label>
                <ion-input placeholder="Enter your code here..." type="text" formControlName="code"></ion-input>
              </ion-item>
              @if (formControlHasError(activationForm, 'code', 'required')) {
                <ion-item lines="none">
                  <ion-label class="error-label">
                    Activation code is required
                  </ion-label>
                </ion-item>
              }
              @if (formControlHasError(activationForm, 'code', 'minlength')) {
                <ion-item lines="none">
                  <ion-label class="error-label">
                    Activation code should be 8 characters long
                  </ion-label>
                </ion-item>
              }
              @if (formControlHasError(activationForm, 'code', 'maxlength')) {
                <ion-item lines="none">
                  <ion-label class="error-label">
                    Activation code should be 8 characters long
                  </ion-label>
                </ion-item>
              }
              <ion-item>
                <ion-label position="stacked">Your password</ion-label>
                <ion-input placeholder="Enter your password here..." type="password" formControlName="password"></ion-input>
              </ion-item>
              @if (formControlHasError(activationForm, 'password', 'required')) {
                <ion-item lines="none">
                  <ion-label class="error-label">
                    Password is required
                  </ion-label>
                </ion-item>
              }
              @if (formControlHasError(activationForm, 'password', 'minlength')) {
                <ion-item lines="none">
                  <ion-label class="error-label">
                    Password needs to be at least 8 characters long
                  </ion-label>
                </ion-item>
              }
              <ion-item>
                <ion-label position="stacked">Confirm your password</ion-label>
                <ion-input placeholder="Confirm your password here..." type="password" formControlName="passwordConfirm"></ion-input>
              </ion-item>
              @if (formControlHasError(activationForm, 'password', 'required')) {
                <ion-item lines="none">
                  <ion-label class="error-label">
                    Password confirmation is required
                  </ion-label>
                </ion-item>
              }
              @if (activationForm.controls['passwordConfirm'].touched && formHasError(activationForm, 'passwordMismatch')) {
                <ion-item lines="none">
                  <ion-label class="error-label">
                    Passwords do not match
                  </ion-label>
                </ion-item>
              }
              <ion-button [disabled]="!activationForm.valid" type="submit">Activate</ion-button>
            </form>
          }
        </ion-card-content>
      </ion-card>
    </ion-col>
  </ion-row>
</ion-content>
